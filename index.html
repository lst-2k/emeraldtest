<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emerald Tour Leaderboard</title>
    <style>
        body { font-family: 'Segoe UI', sans-serif; margin: 0; padding: 0; background-color: #f4f4f4; }

        /* --- STICKY BRANDING SECTION --- */
        .sticky-top-wrap {
            position: sticky;
            top: 0;
            z-index: 1000;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .main-header { 
            background-color: #1b5e20; 
            color: white; 
            text-align: center; 
            padding: 15px; 
            font-weight: bold; 
            font-size: 24px; 
            border-bottom: 4px solid #fbc02d; 
            text-transform: uppercase; 
        }
        .info-bar { 
            background-color: #333; 
            color: #ffeb3b; 
            padding: 10px 20px; 
            display: flex; 
            justify-content: center; 
            gap: 40px; 
            align-items: center; 
            font-size: 14px; 
            font-weight: bold; 
        }
        .venue-section { 
            text-align: center; 
            padding: 15px 0; 
            background: white; 
            border-bottom: 1px solid #ddd; 
        }
        .venue-section h2 { color: #1b5e20; margin: 0; font-size: 24px; text-transform: uppercase; }
        .venue-section p { font-weight: bold; margin: 5px 0 0 0; font-size: 16px; color: #333; }

        /* --- CONTENT AREA --- */
        .content-padding { padding: 20px; }
        .section-title { text-align:center; color:#1b5e20; text-transform: uppercase; margin-top: 30px; margin-bottom: 15px; }

        /* --- HALL OF FAME CARDS --- */
        .hof-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            margin-bottom: 50px;
            flex-wrap: wrap;
        }
        .hof-card {
            border-radius: 12px;
            padding: 25px 15px;
            width: 190px;
            text-align: center;
            box-shadow: 0 6px 15px rgba(0,0,0,0.15);
        }
        .hof-card.gold { background: linear-gradient(145deg, #d4af37, #b8860b); color: #000; border: 2px solid #ffd700; }
        .hof-card.silver { background: linear-gradient(145deg, #c0c0c0, #8e8e8e); color: #000; border: 2px solid #e8e8e8; }
        .hof-card.bronze { background: linear-gradient(145deg, #cd7f32, #8b4513); color: #fff; border: 2px solid #ffa07a; }
        
        .medal-svg { width: 70px; height: 70px; margin-bottom: 10px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)); }
        .hof-name { font-size: 20px; font-weight: bold; display: block; margin: 10px 0 5px 0; }
        .hof-earn { font-weight: bold; font-size: 18px; }

        /* --- TABLES --- */
        .table-container { 
            width: 100%; 
            overflow-x: auto; 
            background-color: white; 
            border: 1px solid #ddd;
            margin-bottom: 20px;
            border-radius: 4px;
        }
        table { width: 100%; border-collapse: collapse; min-width: 1000px; }
        th { background-color: #1b5e20; color: white; padding: 12px; text-transform: uppercase; font-size: 12px; border-bottom: 2px solid #fbc02d; }
        td { padding: 12px; border-bottom: 1px solid #eee; text-align: center; }
        
        /* ICONS */
        .platform-icon { width: 22px; height: 22px; vertical-align: middle; margin-right: 10px; object-fit: contain; }
        .icon-xbox { filter: invert(30%) sepia(85%) saturate(1200%) hue-rotate(85deg) brightness(90%) contrast(105%); }
        .icon-ps { filter: invert(13%) sepia(95%) saturate(5451%) hue-rotate(219deg) brightness(91%) contrast(106%); }
        .icon-pc { filter: invert(46%) sepia(85%) saturate(1514%) hue-rotate(174deg) brightness(101%) contrast(102%); }
        .icon-steam { filter: none; } /* Steam is already dark/neutral */
        
        .top-tier-bg td { background: linear-gradient(to bottom, #f1f8e9, #ffffff) !important; }
    </style>
</head>
<body>

    <div class="sticky-top-wrap">
        <div class="main-header">NEW EMERALD TOUR LEADERBOARD</div>
        <div class="info-bar">
            <div>DATE: <span id="event-date" style="color: white;">--</span></div>
            <div>PAR: <span id="course-par" style="color: white;">--</span></div>
        </div>
        <div class="venue-section">
            <h2 id="current-venue">Loading...</h2>
            <p id="total-prize-pool">Total Prize Pool: --</p>
        </div>
    </div>

    <div class="content-padding">
        
        <h3 class="section-title">Tournament Leaderboard</h3>
        <div class="table-container">
            <table>
                <thead>
                    <tr><th>POS</th><th style="text-align:left;">PLAYER</th><th>TO PAR</th><th>R1</th><th>R2</th><th>R3</th><th>R4</th><th>TOTAL</th><th>PRIZES</th></tr>
                </thead>
                <tbody id="leaderboard-body"></tbody>
            </table>
        </div>

        <h3 class="section-title">Season Stats</h3>
        <div class="table-container">
            <table>
                <thead>
                    <tr><th>Rank</th><th style="text-align:left;">Player</th><th>Points</th><th>Earnings</th><th>Events</th><th>FIR %</th><th>GIR %</th><th>Scram</th><th>NTP</th></tr>
                </thead>
                <tbody id="stats-body"></tbody>
            </table>
        </div>

        <h3 class="section-title">Tournament History</h3>
        <div class="table-container">
            <table>
                <thead>
                    <tr><th>Season</th><th style="text-align:left;">Event/Venue</th><th>Winner</th><th>Score</th><th>Prize</th></tr>
                </thead>
                <tbody id="history-body"></tbody>
            </table>
        </div>

        <h3 class="section-title">Earnings Hall of Fame</h3>
        <div id="hof-display" class="hof-container"></div>
    </div>

    <script>
const DATA_URL = 'data.json';

const platformIcons = {
    'fa-playstation': 'https://upload.wikimedia.org/wikipedia/commons/0/00/PlayStation_logo.svg',
    'fa-xbox': 'https://upload.wikimedia.org/wikipedia/commons/f/f9/Xbox_one_logo.svg',
    'fa-steam': 'https://upload.wikimedia.org/wikipedia/commons/8/83/Steam_icon_logo.svg',
    'fa-windows': 'https://upload.wikimedia.org/wikipedia/commons/a/ae/Windows_logo_-_2012.svg'
};

const getMedalSVG = (color) => `
    <svg class="medal-svg" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <circle cx="12" cy="14" r="8" fill="${color}" stroke="rgba(0,0,0,0.1)" stroke-width="0.5"/>
        <path d="M12 10.5l1.2 2.4 2.6.4-1.9 1.8.5 2.6-2.4-1.2-2.4 1.2.5-2.6-1.9-1.8 2.6-.4z" fill="rgba(0,0,0,0.2)"/>
    </svg>`;

async function loadData() {
    try {
        const response = await fetch(DATA_URL + '?t=' + Date.now());
        if (!response.ok) throw new Error("JSON file not found");
        const data = await response.json();
        renderData(data);
    } catch (err) { 
        console.error("Load Error:", err);
        document.getElementById('current-venue').innerText = "Data Loading Error";
    }
}

function renderData(data) {
    // 1. TOP BAR & VENUE INFO (Mapped to image_d711e6.png)
    const parVal = parseInt(data.coursePar) || 72;
    document.getElementById('current-venue').innerText = data.venue || "Tournament";
    document.getElementById('course-par').innerText = parVal;
    document.getElementById('event-date').innerText = data.date || "--";
    const prize = data.prizePool ? "£" + data.prizePool.toLocaleString() : "--";
    document.getElementById('total-prize-pool').innerText = `Total Prize Pool: ${prize}`;

    // 2. TOURNAMENT LEADERBOARD (Mapped to image_d7910c.png)
    const lbBody = document.getElementById('leaderboard-body');
    lbBody.innerHTML = "";

    if (data.players && Array.isArray(data.players)) {
        let players = data.players.map(p => {
            // Rounds are stored as strings "64", "72", etc. in your JSON
            const rounds = [p.r1, p.r2, p.r3, p.r4].map(r => parseInt(r) || 0);
            const active = rounds.filter(r => r > 0);
            const total = active.reduce((a, b) => a + b, 0);
            
            let sort = 999, toPar = "--";
            if (active.length > 0) {
                sort = total - (parVal * active.length);
                toPar = sort > 0 ? `+${sort}` : (sort === 0 ? "E" : sort);
            }

            const iconUrl = platformIcons[p.console] || "";
            const iconHtml = iconUrl ? `<img src="${iconUrl}" class="platform-icon" crossorigin="anonymous">` : "";

            return { ...p, rounds, total, toPar, sort, iconHtml };
        }).sort((a, b) => a.sort - b.sort);

        // Tied Rank Logic
        let currentRank = 0;
        players.forEach((p, i) => {
            const isTied = i > 0 && p.sort === players[i - 1].sort;
            const nextIsTied = i < players.length - 1 && p.sort === players[i + 1].sort;
            if (!isTied) currentRank = i + 1;
            const displayRank = (isTied || nextIsTied) ? "T" + currentRank : currentRank;
            
            const pText = p.toPar.toString();
            let color = (pText === 'E') ? "green" : (pText.includes('+') ? "black" : "red");

            lbBody.innerHTML += `
                <tr>
                    <td>${displayRank}</td>
                    <td style="text-align:left; font-weight:bold;">${p.iconHtml}${p.name}</td>
                    <td style="font-weight:bold; color:${color}">${pText}</td>
                    <td>${p.rounds[0]||'-'}</td><td>${p.rounds[1]||'-'}</td><td>${p.rounds[2]||'-'}</td><td>${p.rounds[3]||'-'}</td>
                    <td><b>${p.total||'-'}</b></td>
                    <td>--</td>
                </tr>`;
        });
    }

    // 3. SEASON STATS (Mapped to image_d711e6.png objects)
    const statsBody = document.getElementById('stats-body');
    statsBody.innerHTML = "";
    
    if (data.seasonEarnings && data.seasonPoints) {
        const playerNames = Object.keys(data.seasonEarnings);
        
        let statsList = playerNames.map(name => {
            return {
                name: name,
                pts: data.seasonPoints[name] || 0,
                earn: data.seasonEarnings[name] || 0,
                ev: data.eventCount || 0
            };
        }).sort((a, b) => b.pts - a.pts);

        statsList.forEach((s, i) => {
            statsBody.innerHTML += `
                <tr>
                    <td>${i + 1}</td>
                    <td style="text-align:left; font-weight:bold;">${s.name}</td>
                    <td><b>${s.pts}</b></td>
                    <td style="color:#1b5e20; font-weight:bold;">£${s.earn.toLocaleString()}</td>
                    <td>${s.ev}</td>
                    <td>--</td><td>--</td><td>--</td><td>--</td>
                </tr>`;
        });

        // 4. HALL OF FAME (Top 3 Earners)
        const hofDisplay = document.getElementById('hof-display');
        const hofStats = [...statsList].sort((a, b) => b.earn - a.earn);
        const cardClasses = ['gold', 'silver', 'bronze'];
        const medalColors = ['#FFD700', '#C0C0C0', '#CD7F32'];
        
        hofDisplay.innerHTML = hofStats.slice(0, 3).map((s, i) => `
            <div class="hof-card ${cardClasses[i]}">
                ${getMedalSVG(medalColors[i])}
                <span class="hof-name">${s.name}</span>
                <span class="hof-earn">£${s.earn.toLocaleString()}</span>
            </div>`).join('');
    }
}

loadData();
	</script>
</body>
</html>